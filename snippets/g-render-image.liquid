{% comment %}
  Snippet: g-render-image
  Created by: Leonid Dulher

  Passed variables:
  - class: {String} className in img tag (optional)
  - img_src: {String} to render url image
  - alt: {String} alt in image
  - img: {Object} image object
  - id: {String} image id
  - size: {String} size responsive with spaces
  - width: {String} default width (optional)
  - height: {String} default height (optional)
  - loading: {String} load an image immediately or to defer loading of off-screen images | default: 'lazy' | options: 'lazy', 'eager'

  Render example:
    {% render "g-render-image"
      class: "class_image",
      style: "<styles>",
      img_src: <img_url>,
      img: <img_object>,
      size: "220 300 400 500",
      alt: "Image alt",
      width: "100",
      height: "100"
      loading: "eager"
      id: 'id_image'
    %}
{% endcomment %}

{% liquid
  if size contains ' '
    assign size_split = size | split: ' '
  else
    assign size_split = '220 300 600 900' | split: ' '
  endif
  if img
    assign default = img | image_url: width: 30
  endif
  comment
    cause google need at least 300x to render on their pages
  endcomment
  if for_google
    assign default = img | image_url: width: 300
  endif
%}
<img
  {% if id %}
    id="{{- id -}}"
  {% endif %}
  class="{{ class }}{% unless loading == "eager" %} blur-up lazyload image-alt {% endunless %}"
  {% unless style == blank %}style="{{ style }}"{% endunless %}
  loading="{{ loading | default: 'lazy' }}"
  {% if attributes != blank %}{{ attributes }}{% endif %} 
  data-sizes="auto"
  {% if loading == 'eager' %}
    src="{{ default | default: img_src }}"
    srcset="
      {%- if img -%}
        {%- for img_size in size_split -%}
          {%- assign sizex = img_size | append: 'x' -%}
          {%- assign sizew = img_size | append: 'w' -%}
          {%- assign imge_url = img | img_url: sizex -%}
          {{ imge_url }} {{ sizew }},
        {%- endfor -%}
      {%- else -%}
        {{ img_src }}
      {%- endif -%}
    "
  {% else %}
    src="
    {% if img != blank %}
      {{ img | image_url: width: 10 }}
    {% else %}
        {{ img_src }}
    {% endif %}"
    data-src="{{ default | default: img_src }}"
    data-srcset="
      {%- if img -%}
        {%- for img_size in size_split -%}
          {%- assign sizex = img_size | append: 'x' -%}
          {%- assign sizew = img_size | append: 'w' -%}
          {%- assign imge_url = img | img_url: sizex -%}
          {{ imge_url }} {{ sizew }},
        {%- endfor -%}
      {%- else -%}
        {{ img_src }}
      {%- endif -%}
    "
  {% endif %}
  alt="{{ alt | default: 'Image to render' }}"
  width="{{ width | default: '100' }}"
  height="{{ height | default: '100' }}"
  {% if title != blank %}
  title="{{ title }}"
  {% endif %}
>
